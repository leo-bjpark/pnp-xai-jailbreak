{# Shared app title bar. Expects: header_title (string). Optional: export_as_link (bool, default false) â€” if true, Export is an <a>, else <button id="btn-export">. #}
<header class="app-title-bar">
  <div class="app-title-bar-left">
    <h1>PnP-XAI-LLM</h1>
    <div class="app-title-bar-meta">
      <span>Version 0.1</span>
      <span>(c) KAIST-SAIL</span>
    </div>
  </div>
  <div class="app-title-bar-center">
    <div class="app-log-panel" id="app-log-panel" aria-live="polite">
      <div class="app-log-title">Log</div>
      <div class="app-log-preview" id="app-log-preview">â€”</div>
      <div class="app-log-popover" id="app-log-popover" aria-hidden="true">
        <div class="app-log-popover-title">Log History</div>
        <div class="app-log-list" id="app-log-list"></div>
      </div>
    </div>
  </div>
  <div class="app-title-bar-right">
    <div class="json-wrap">
      <button type="button" class="btn-json" id="btn-json" title="Hover for Export/Import">Json</button>
      <div class="json-dropdown" id="json-dropdown">
        {% if export_as_link %}
        <a href="/api/memory/export" class="json-option">Export</a>
        {% else %}
        <button type="button" class="json-option" id="btn-export">Export</button>
        {% endif %}
        <button type="button" class="json-option" id="btn-import">Import</button>
      </div>
    </div>
    <input type="file" id="import-file-input" accept=".json" hidden />
    <div class="theme-custom-wrap" id="theme-custom-wrap">
      <button type="button" class="theme-toggle" id="theme-toggle" title="Toggle theme (Sun: White, Moon: Black)" aria-label="Toggle theme">
        <span class="theme-icon theme-sun" aria-hidden="true">â˜€</span>
        <span class="theme-icon theme-moon" aria-hidden="true">ðŸŒ™</span>
      </button>
      <div class="theme-custom-panel" id="theme-custom-panel" aria-hidden="true">
        <div class="theme-custom-actions">
          <button type="button" class="theme-custom-reset" id="theme-custom-reset">Set to Default</button>
          <button type="button" class="theme-custom-update" id="theme-custom-update">Apply</button>
        </div>
        <div class="theme-custom-header">
          <span>Element</span>
          <span>Color</span>
        </div>
        <div class="theme-custom-row"><span>Background</span><input type="color" data-var="--bg" /></div>
        <div class="theme-custom-row"><span>Panel</span><input type="color" data-var="--panel" /></div>
        <div class="theme-custom-row"><span>Sidebar</span><input type="color" data-var="--sidebar" /></div>
        <div class="theme-custom-row"><span>Text</span><input type="color" data-var="--text" /></div>
        <div class="theme-custom-row"><span>Muted</span><input type="color" data-var="--muted" /></div>
        <div class="theme-custom-row"><span>Border</span><input type="color" data-var="--border" /></div>
        <div class="theme-custom-row"><span>Brand</span><input type="color" data-var="--brand" /></div>
        <div class="theme-custom-row"><span>Accent</span><input type="color" data-var="--accent" /></div>
        <div class="theme-custom-row"><span>Hover</span><input type="color" data-var="--hover" /></div>
      </div>
    </div>
  </div>
  <script>
  (function() {
    function initVariableBtn() {
      var b = document.getElementById("btn-clear-variable");
      var dd = document.getElementById("data-vars-dropdown");
      if (!b || !dd) return;
      b.addEventListener("click", function(e) {
        e.stopPropagation();
        e.preventDefault();
        var isOpen = dd.classList.contains("visible");
        if (isOpen) { dd.classList.remove("visible"); dd.setAttribute("aria-hidden", "true"); }
        else {
          if (typeof window.refreshWorkingMemoryList === "function") window.refreshWorkingMemoryList();
          dd.classList.add("visible");
          dd.setAttribute("aria-hidden", "false");
        }
      });
    }
    if (document.readyState === "loading") document.addEventListener("DOMContentLoaded", initVariableBtn);
    else initVariableBtn();
  })();
  </script>
  <div class="status-toast" id="status-toast" aria-live="polite" aria-hidden="true"></div>
</header>
