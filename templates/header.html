{# Shared app title bar. Expects: header_title (string). Optional: export_as_link (bool, default false) â€” if true, Export is an <a>, else <button id="btn-export">. #}
<header class="app-title-bar">
  <div class="app-title-bar-left">
    <h1>PnP-XAI-LLM</h1>
  </div>
  <div class="app-title-bar-center">
    <div class="memory-clear-btns">
      <div class="memory-panel-wrap">
        <button type="button" class="btn-memory-clear btn-clear-session" id="btn-clear-session" title="Session Â· ëª©ë¡ ë³´ê¸° Â· ê°œë³„ ì‚­ì œ">
          <span class="btn-memory-icon">ğŸ§µ</span>
          <span class="btn-memory-label">Session</span>
        </button>
        <div class="memory-dropdown" id="session-dropdown" aria-hidden="true">
          <div class="data-vars-dropdown-header">Session Â· Task | model | treatment | ì´ë¦„ (Cache)</div>
          <div class="data-vars-table-wrap">
            <table class="data-vars-table">
              <thead><tr><th class="data-vars-th-name">Task | model | treatment | ì´ë¦„</th><th class="data-vars-th-action"></th></tr></thead>
              <tbody id="session-tbody">
                <tr class="data-vars-empty-row" id="session-empty-row"><td colspan="2">No caches.</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="memory-panel-wrap">
        <button type="button" class="btn-memory-clear btn-clear-result" id="btn-clear-result" title="ê²°ê³¼ Â· ëª©ë¡ ë³´ê¸° Â· ê°œë³„ ì‚­ì œ">
          <span class="btn-memory-icon">ğŸ“„</span>
          <span class="btn-memory-label">Results</span>
        </button>
        <div class="memory-dropdown" id="result-dropdown" aria-hidden="true">
          <div class="data-vars-dropdown-header">ê²°ê³¼ Â· Task list</div>
          <div class="data-vars-table-wrap">
            <table class="data-vars-table">
              <thead><tr><th class="data-vars-th-name">Name</th><th class="data-vars-th-memory">Model Â· Level</th><th class="data-vars-th-action"></th></tr></thead>
              <tbody id="result-tbody">
                <tr class="data-vars-empty-row" id="result-empty-row"><td colspan="3">No items.</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="memory-panel-wrap">
        <button type="button" class="btn-memory-clear btn-clear-variable" id="btn-clear-variable" title="Variables Â· ëª©ë¡ ë³´ê¸° Â· ê°œë³„ ì‚­ì œ">
          <span class="btn-memory-icon">ğŸ§Š</span>
          <span class="btn-memory-label">Variables</span>
        </button>
        <div class="memory-dropdown data-vars-dropdown" id="data-vars-dropdown" aria-hidden="true">
          <div class="data-vars-dropdown-header">Variables Â· Loaded model &amp; saved data</div>
          <div class="data-vars-table-wrap">
            <table class="data-vars-table">
              <thead><tr><th class="data-vars-th-name">Name</th><th class="data-vars-th-memory">Memory (GPU / RAM)</th><th class="data-vars-th-action"></th></tr></thead>
              <tbody id="data-vars-tbody">
                <tr class="data-vars-empty-row" id="data-vars-empty-row"><td colspan="3" id="data-vars-empty">No items.</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="memory-summary-wrap" id="memory-summary-wrap" title="Session | Result | Variable memory (GB)">
        <span class="memory-summary-label">Session</span><span class="memory-summary-value" id="memory-summary-session">â€”</span>
        <span class="memory-summary-sep">|</span>
        <span class="memory-summary-label">Result</span><span class="memory-summary-value" id="memory-summary-result">â€”</span>
        <span class="memory-summary-sep">|</span>
        <span class="memory-summary-label">Variable</span><span class="memory-summary-value" id="memory-summary-variable">â€”</span>
      </div>
    </div>
  </div>
  <div class="app-title-bar-right">
    <div class="json-wrap">
      <button type="button" class="btn-json" id="btn-json" title="Hover for Export/Import">Json</button>
      <div class="json-dropdown" id="json-dropdown">
        {% if export_as_link %}
        <a href="/api/memory/export" class="json-option">Export</a>
        {% else %}
        <button type="button" class="json-option" id="btn-export">Export</button>
        {% endif %}
        <button type="button" class="json-option" id="btn-import">Import</button>
      </div>
    </div>
    <input type="file" id="import-file-input" accept=".json" hidden />
    <button type="button" class="theme-toggle" id="theme-toggle" title="Toggle theme (Sun: White, Moon: Black)" aria-label="Toggle theme">
      <span class="theme-icon theme-sun" aria-hidden="true">â˜€</span>
      <span class="theme-icon theme-moon" aria-hidden="true">ğŸŒ™</span>
    </button>
    <div class="app-title-bar-meta">
      <span>Version 0.1</span>
      <span>(c) KAIST-SAIL</span>
    </div>
  </div>
  <script>
  (function() {
    function initVariableBtn() {
      var b = document.getElementById("btn-clear-variable");
      var dd = document.getElementById("data-vars-dropdown");
      if (!b || !dd) return;
      b.addEventListener("click", function(e) {
        e.stopPropagation();
        e.preventDefault();
        var isOpen = dd.classList.contains("visible");
        if (isOpen) { dd.classList.remove("visible"); dd.setAttribute("aria-hidden", "true"); }
        else {
          if (typeof window.refreshWorkingMemoryList === "function") window.refreshWorkingMemoryList();
          dd.classList.add("visible");
          dd.setAttribute("aria-hidden", "false");
        }
      });
    }
    if (document.readyState === "loading") document.addEventListener("DOMContentLoaded", initVariableBtn);
    else initVariableBtn();
  })();
  </script>
</header>
