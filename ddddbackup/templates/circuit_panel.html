<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Circuit Panel – PnP-XAI-LLM</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/styles.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/circucit-input.css') }}"
    />
  </head>
  <body>
    <nav class="tab-bar" aria-label="Page navigation">
      <div class="tab-bar-tabs">
        <a href="/" class="tab-link {{ 'active' if active_tab == 'main' else '' }}">Main</a>
        <a href="/model_load" class="tab-link {{ 'active' if active_tab == 'model_load' else '' }}">Model Load</a>
        <a href="/src_destination" class="tab-link {{ 'active' if active_tab == 'src_destination' else '' }}">SRC / Destination</a>
        <a href="/circuit_panel" class="tab-link {{ 'active' if active_tab == 'circuit_panel' else '' }}">Circuit</a>
        <a href="/computation_test" class="tab-link {{ 'active' if active_tab == 'computation_test' else '' }}">Computation Test</a>
      </div>
      <div class="tab-bar-actions">
        <span class="tab-bar-loaded">Loaded: <span id="global-loaded-model">—</span></span>
        <div class="toolbar-group">
          <span class="toolbar-label">Model</span>
          <select id="model" class="toolbar-select">
            {% for m in models %}
            <option value="{{ m }}">{{ m }}</option>
            {% endfor %}
          </select>
          <button type="button" id="load-model" class="toolbar-button">Load</button>
        </div>
      </div>
    </nav>
    <header>
      <div class="header-bottom">
        <h1>Circuit Panel</h1>
        <p class="header-help">입력 모드: 단순 Forward(인코딩만) / 생성기반(질문→생성→해석) / 사용자 입력 질문-대답(직접 입력→chat_template→해석). Run 후 최종 텍스트에 대해 forward 해석 결과를 표시합니다.</p>
      </div>
    </header>
    <main class="main-circuit">
      <section class="card">
        <div id="circuit-input-root"></div>
      </section>
      <section class="card circuit-result-card">
        <div class="circuit-next-token-row">
          <span class="circuit-next-label">Next token (가장 확률 높은 다음 토큰):</span>
          <span id="circuit-next-token" class="circuit-next-value">—</span>
        </div>
        <div class="circuit-heatmap-wrap">
          <div class="circuit-view-tabs" role="tablist">
            <button type="button" class="circuit-view-tab active" data-view="heatmap" role="tab">Heatmap</button>
            <button type="button" class="circuit-view-tab" data-view="circuit" role="tab">Circuit</button>
          </div>
          <figure id="circuit-heatmap-figure" class="circuit-heatmap-figure" aria-label="Circuit: X축 토큰, Y축 레이어">
            <!-- Heatmap 또는 Circuit graph (JS에서 채움) -->
          </figure>
        </div>
        <div id="circuit-error" class="model-status-error" hidden></div>
      </section>
    </main>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script src="{{ url_for('static', filename='js/circuit-input.js') }}"></script>
    <script src="{{ url_for('static', filename='js/circuit.js') }}"></script>
  </body>
</html>
