<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Computation Test – Node Visualization</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/computation_test.css') }}" />
  </head>
  <body>
    <nav class="tab-bar" aria-label="Page navigation">
      <div class="tab-bar-tabs">
        <a href="/" class="tab-link {{ 'active' if active_tab == 'main' else '' }}">Main</a>
        <a href="/model_load" class="tab-link {{ 'active' if active_tab == 'model_load' else '' }}">Model Load</a>
        <a href="/src_destination" class="tab-link {{ 'active' if active_tab == 'src_destination' else '' }}">SRC / Destination</a>
        <a href="/circuit_panel" class="tab-link {{ 'active' if active_tab == 'circuit_panel' else '' }}">Circuit</a>
        <a href="/computation_test" class="tab-link {{ 'active' if active_tab == 'computation_test' else '' }}">Computation Test</a>
      </div>
      <div class="tab-bar-actions">
        <span class="tab-bar-loaded">Loaded: <span id="global-loaded-model">—</span></span>
        <div class="toolbar-group">
          <span class="toolbar-label">Model</span>
          <select id="model" class="toolbar-select">
            {% for m in models %}
            <option value="{{ m }}">{{ m }}</option>
            {% endfor %}
          </select>
          <button type="button" id="load-model" class="toolbar-button">Load</button>
        </div>
      </div>
    </nav>
    <header>
      <div class="header-bottom">
        <h1>Computation Test</h1>
        <p class="header-help">노드·레이어 시각화 테스트. Test Token 고정, 가정 데이터로 무엇이 필요한지 확인.</p>
      </div>
    </header>
    <main class="main-computation-test">
      <section class="card comp-test-card">
        <h2 class="comp-test-title">Test Token</h2>
        <p class="comp-test-sentence" id="comp-test-sentence">{{ test_sentence }}</p>
        <p class="comp-test-meta">
          Tokens: <span id="comp-token-list"></span> · Layers: <span id="comp-num-layers"></span>
        </p>
      </section>
      <section class="card comp-viz-card">
        <h2 class="comp-viz-title">Node × Layer (가정 시각화)</h2>
        <div class="comp-viz-wrap">
          <figure id="comp-viz-figure" class="comp-viz-figure" aria-label="Nodes per layer and token"></figure>
        </div>
        <p class="comp-viz-hint">Y축: 레이어 (L0 아래 → 위로 Ln). X축: 토큰. 노드 = (layer, token) 셀. 추후 attention/가중치 연동.</p>
      </section>
    </main>
    <script>
      window.COMPUTATION_TEST_DATA = {
        tokens: {{ tokens | tojson }},
        num_layers: {{ num_layers }},
      };
    </script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script src="{{ url_for('static', filename='js/computation_test.js') }}"></script>
  </body>
</html>
